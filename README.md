# 电影个性化推荐系统功能设计

该系统大致可以分为以下几个模块



## 用户交互模块

- 分为注册/登录，每日推荐查询和评分功能；
- 注册时，在用户输入用户名和密码后，系统会自动为用户分配一个数字ID；
- 登录使用用户名和ID都可；
- 登录进去后，用户点击今日推荐，可查看系统为用户独一无二的推荐电影；
- 用户在享受完系统推荐的电影后，可以对所选电影进行评分；

## 服务器-客户端通讯模块

基于TCP协议，双方进行通讯就是用的这个模块，包括

客户端->服务器:

1. 连接
2. 注册 name | pwd
3. 登录 name | pwd
4. 查询 user | isDebug

服务器->客户端(数字代表结果码):

1. 注册成功/失败 5(id)/6 
2. 登录成功/失败 3(id)/4 
3. 查询成功/失败+查询结果 0(data)/1/2

## 个性化推荐模块

* 分为相似度计算和生成推荐列表两部分，使用python运行；
* 服务器每日会进行一次相似度更新(到similarity表)，由于用户每日新增的评分，该功能耗时较长，HeraSim.py实现；
* 服务器在收到客户端的推荐请求时，会跟similarity表进行交互，选出相似度最高的该用户没有评过分的5部电影进行推荐；

## 数据库交互模块

负责服务器对客户端的响应，包括注册，登录，查询，评分和相似度更新

### 用到的数据库结构如下

**users**: id int(4)， name vchar(20)， password char(32)， pk(id)

**movies**: movieID int(4)， name vchar(200)， genre vchar(20)， pk(movieID， genre)

**ratings**: userID int(4)， movieID int(4)， rating float， pk(userID， movieID)

**similarity**: userID int(4)， movieID int(4)， sim float， metapath vchar(10)， timestamp， pk(userID， movieID， metapath)

## 日志模块

负责服务器在有基本行为(包括注册，登录，查询，评分)时，对服务器的行为进行日志记录.

## 

# Code documentation

该系统代码分为三部分**RecClient**， **RecServer**和**AlgoTest**

## RecClient

该部分是可供用户使用的客户端GUI，其中(下文中*表示后缀名，包括但不限于cpp， h， ui， pro):

* `widget.* 系列`:窗口设计模块，包含窗口中各个部件的功能实现以及与服务器连接的功能，例如按钮，文本输入，表格输出等；
* `movie.* 系列`:Movie类模块，包含推荐系统的对象主体（电影）信息，对于该对象的操作全在此模块上；
* `main.cpp`:主函数，负责启动程序和结束程序；
* `RecClient.pro`:Qt的项目文件；

## **RecServer**

该部分是供管理员启动服务查看日志以及为客户端服务的服务器，其中(下文中*表示后缀名，包括但不限于cpp， h， ui， pro):

* `widget.* 系列`:窗口设计模块，包含按钮启动服务和相似度计算，以及一个日志显示文本框；
* `communication.* 系列`:通讯模块，负责帮助窗口与客户端进行数据交流；
* `log.*`:日志模块，负责对服务器进行的基本操作进行日志的记录；
* `database.*`:数据库模块，服务器需要对数据库进行的操作由该模块处理，并由该模块返回值；
* `main.cpp`:主函数，负责启动和结束程序；
* `movie.* 系列`:Movie类模块，包含推荐系统的对象主体（电影）信息，对于该对象的操作全在此模块上；
* `RecServer.pro`:Qt的项目文件；

## AlgoTest

该部分是可供客户端调用的Python脚本程序，分为两个文件和两个文件夹，其中:

* `HeraSim.py`:对数据库进行操作，使用HeraSim算法进行相似度的计算，将新的相似度数据update到数据库中；
* `HeraRec.py`:导入相似度矩阵，并根据用户输入的ID参数，输出推荐的电影列表；
* `load*.py`:作初始化数据库用，读取MovieLens数据集的csv文件，进行users， movies， ratings 等表的初始化.
* `in/out目录`:存放着脚本程序输入输出的数据，包括MovieLens数据集，相似度矩阵，以及推荐的电影列表。



# Change Log:

## v0.3.0 (2018/05/30)

* 使用MySQL数据库管理
* 将原来的文件处理修改为数据库上运行
* 增添账户注册登录功能
* 用户现在可以为电影评分了
* 设定为每日计算一次相似度

## v0.2.0 (2018/04/26)

* 将系统改为C/S架构
* 增添服务器，并将客户端的查询任务转移给服务器
* 客户端只保留输入输出功能

## v0.1.0 (2018/03/25)

* 本地系统原型出世
* 可以进行本地的相似度查询
* 相似度计算很慢